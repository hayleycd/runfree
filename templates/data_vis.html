{% extends 'base.html' %}
{% block body %}
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<!-- <a id="bar_graph_link" href = "/get_bar_graph">View Bar Graph</a> -->
Your Most Recent Runs!
<br><br>
How many runs to you want to see?
<br>

<form  id= "form_bar" action = "/bar_chart">
  <select name = "number_of_runs">
    <option value = 5>5</option>
    <option value = 10>10</option>
    <option value = 20>20</option>
    <option value = 25>25</option>
    <option value = 50>50</option>
    <option value = 75>75</option>
    <option value = 100>100</option>
  </select>
  <input id = "#select_number_of_runs" type="submit" value = "Show me my runs!"></input>
</form>
<br>
<br>
<style>

/*Style for bar chart.*/
.chart text {
  fill: white;
  font: 10px sans-serif;
  text-anchor: end;
}

/*Style for pie chart. */
body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  width: 960px;
  height: 500px;
  position: relative;
}
path.slice{
  stroke-width:2px;
}
polyline{
  opacity: .3;
  stroke: black;
  stroke-width: 2px;
  fill: none;
} 
svg text.data.location{
  fill:white;
  text-anchor:middle;
  font-size:12px;
}

</style>
<svg class="chart"></svg>


<div id="charts">
<div id="bar_graph">
<script>
d3.json("/bar_chart", function(data) {

var distance_list = []

var create_dist_list = function (data) {
  for (var i = 0; i < data.length; i++){
      distance_list.push(data[i].distance)
      }
  return distance_list;
}

create_dist_list(data);

console.log(distance_list)

console.log(data[0].score)



var width = 600,
    barHeight = 25;

var x = d3.scale.linear()
	.domain([0, d3.max(distance_list)])
	.range([0, width]);

var chart = d3.select(".chart")
    .attr("width", width)
    .attr("height", barHeight * distance_list.length);

var bar = chart.selectAll("g")
    .data(data)
  .enter().append("g")
    .attr("transform", function(data, i) { return "translate(0," + i * barHeight + ")"; });

bar.append("rect")
    .attr("width", function(data) { return x(data.distance);})
    .attr("height", barHeight - 1)
    .attr("fill", function(data) {
      if (data.score < 1) {
        return "#FA8072";
      } else if (data.score < 2) {
        return "#DAA520";
      } else if (data.score < 3) {
        return "#FFD700";
      } else if (data.score < 4) {
        return "#32CD32"; 
      } else {
        return "#008000";
      }
    });

bar.append("text")
    .attr("x", function(data) { return x(data.distance) - 3; })
    .attr("y", barHeight / 2)
    .attr("dy", ".35em")
    .text(function(data) { return data.date + "  " + data.distance + "  Miles"; });
  });



</script>
</div>

<div id = "pie_chart">
<br><br>
Pie Chart!
<br><script src="/static/js/donut3d.js"></script>
<script>
// This is the script for the pie chart.

d3.json("/pie_chart", function(data) {

  console.log(data)


  var svg = d3.select("#pie_chart").append("svg").attr("width",500).attr("height",500);

  svg.append("g").attr("id","locationDonut");

  Donut3D.draw("locationDonut", provide_data(data) , 150, 150, 130, 100, 30, 0);

  // svg.append("text")
  //   .text(function(data) { return "text"})

  function provide_data(data) {
    return data.map(function (d) {
        return {label: d.location, value: d.occurances, color: d.color}; 
    });
  }
});

</script>
</div>

<div id="mood_bubbles">
  <br><br>
  How Did You Feel?
  <br><br>
<script>

var diameter = 350,
    format = d3.format(",d"),
    color = d3.scale.category10();

var bubble = d3.layout.pack()
    .sort(null)
    .size([diameter, diameter])
    .padding(1.5);

var svg1 = d3.select("#mood_bubbles").append("svg")
    .attr("width", diameter)
    .attr("height", diameter)
    .attr("class", "bubble");

d3.json("/mood_map_before", function(error, root) {

  var node1 = svg1.selectAll(".node")
      .data(bubble.nodes(classes(root))
      .filter(function(d) { return !d.children; }))
      .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

  node1.append("title")
      .text(function(d) { return d.className + ": " + format(d.name); });

  node1.append("circle")
      .attr("r", function(d) { return d.r; })
      .style("fill", function(d) { return color(d.className.substring(0, d.r / 3)); });

  node1.append("text")
      .attr("dy", ".3em")
      .style("text-anchor", "middle")
      .text(function(d) { return d.className.substring(0, d.r / 3); });
});

// Returns a flattened hierarchy containing all leaf nodes under the root.
function classes(root) {
  var classes = [];

  function recurse(name, node) {
    if (node.children) node.children.forEach(function(child) { recurse(node.name, child); });
    else classes.push({packageName: name, className: node.name, value: node.size});
  }

  recurse(null, root);
  return {children: classes};
}

d3.select(self.frameElement).style("height", diameter + "px");

</script>


</div>
</div>


{% endblock %}