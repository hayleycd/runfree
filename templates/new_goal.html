<!-- This will be where users can set a new goal. --> 
{% extends 'base.html' %}
{% block body %}
<form id="goal_form" action="/add_goal" method="POST">
	<h3>Set a New Goal</h3>
	<p>Select a goal: </p>
	<select name="goal">
		<!-- I took out the mile goal so I can focus on the goals that could conceivably have an associated race and mile runs are not common race distances. -->
		<!-- <option value="run_1_mile">Run 1 Mile</option> -->
		<option value="run_walk_5k">Run/Walk 5k</option>
		<option value="run_5k">Run 5k</option>
		<option value="run_walk_10k">Run/Walk 10k</option>
		<option value="run_10k">Run 10k</option>
		<option value="run_walk_half">Run/Walk Half Marathon</option>
		<option value="run_half">Run Half Marathon</option>
<!-- 		I am not sure I want to tackle Full Marathons in my project. It really isn't something a beginner should be worried about and I haven't done one yet, so I don't have any reference. But I
will leave the options here in case I change my mind. --> 
<!-- 	<option value="run_walk_full">Run/Walk Marathon</option>
		<option value="run_full">Run Marathon</option>
 --></select>
	<br>
	<p>Select current running fitness: </p>
	<select name="fitness_level">
		<option value=1>New runner, new to excercise</option>
		<option value=2>New runner, coming back to excercise after a break</option>
		<option value=3>New runner, but regular excerciser</option>
		<option value=4>Casual runner or run/walker, less than 3 months</option>
		<option value=5>Casual runner or run/walker, 3-6 months</option>
		<option value=6>Casual runner or run/walker, 6-12 months</option>
		<option value=7>Casual runner or run/walker, 12 + months</option>
		<option value=8>Serious runner, 6-12 months</option>
		<option value=9>Serious runner, 12 + months</option>
	</select>
	<br>
	<p>What is the longest distance you have completed: </p>
	<select name="run_length_history">
		<option value=1>0-2 miles</option>
		<option value=2>2-4 miles</option>
		<option value=3>4-7 miles</option>
		<option value=4>7-10 miles</option>
		<option value=5>10 + miles</option>
	</select>
	<br>
	<div id="race_div">
		<p>Click here to find a race: </p><button id="race_check" type="button">Ready, Set, Go!</button>
	</div>
	<br>
	<div id="race_questions" style="display: none">
		<br>
		<p>Where would you like to race?</p>
		<input type="text" name="zipcode"> Enter Zipcode</input>
		<br>
<!-- 		<input type="text" name="state"> Enter State</input> -->
		<br><br>
		<button id="search_active_api" type="button">Find a Race</button> 

	</div>
	<div id="possible_races"></div>
	<script>

	// Displays race questions when user indicates that they want them. 
	
	$("#race_check").on("click", function (evt) {
		// console.log("Running")
		$("#race_questions").attr("style", "display: block");
		$("#race_div").attr("style", "display: none")
	});

	// Sends the info from the form to my route in my controller file, so I can manipulate it a bit before making an api call. 

	$("#search_active_api").on("click", function () {
		var form_data = $("#goal_form").serialize();
		var url = "/race_search?" + form_data

		$.get(url, function (data) {
			console.log(JSON.parse(data));
			var events = JSON.parse(data);
			var html_new = "<br>";
			var json_object;

			for (var i=0; i<events.length; i++){
				// Parses the date from the api data.
				 var new_date = Date.parse(events[i]['activityStartDate']);
				 // Creates a new date object that we will work with. 
				 var new_date_obj = new Date();
				 // Sets date in order to match the date from the api. 
				 new_date_obj.setTime(new_date);

				 // The start date from the api is actually
				 // one month prior to the race date. I am most interested in the race date, so
				 // I am adjusting accordingly.  


				 if (new_date_obj.getMonth() === 12) {
				 	new_date_obj.setMonth(1);
				 	new_date_obj.setFullYear(new_date_obj.getFullYear()+1);
				 } else {
				 	new_date_obj.setMonth(new_date_obj.getMonth() + 1);
				 }
		
				var temporary_list = [events[i]['homePageUrlAdr'], new_date_obj, events[i]['assetGuid']];

				json_object = JSON.stringify(temporary_list);
				
				html_new = html_new + "<input type='radio' name= 'race' value="+ json_object + "></input>		" + new_date_obj.getMonth()+"-"+new_date_obj.getDate()+"-"+new_date_obj.getFullYear() + "<br><a href=" + events[i]['homePageUrlAdr']+ ' target="_blank">' + events[i]['homePageUrlAdr']+ '</a><br><a href='+ events[i]['registrationUrlAdr'] + ' target="_blank"> Register Here!</a><br>' + events[i]['assetDescriptions'][0].description + '<br>'
			};
			$("#possible_races").html(html_new)
		})
	});

	</script>
	<br>
	<input type="submit"></input>

</form>


{% endblock %}